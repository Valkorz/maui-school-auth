<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:Class="MauiApp2.Minipages.SchedulingPopup"
    BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundColorLight}, Dark={StaticResource BackgroundColorDark}}">

    <toolkit:Popup.Resources>
        <Style x:Key="CalendarCellStyle" TargetType="Border">
            <Setter Property="Stroke" Value="LightGray" />
            <Setter Property="StrokeThickness" Value="1" />
        </Style>
        <Style x:Key="CalendarCellButtonStyle" TargetType="Button">
            <Setter Property="BackgroundColor" Value="Transparent"/>
        </Style>
        <Style x:Key="CardHeadingStyle" TargetType="BoxView">
            <Setter Property="BackgroundColor" Value="#0099CC"/>
            <Setter Property="MinimumHeightRequest" Value="25"/>
        </Style>
    </toolkit:Popup.Resources>

    <Grid Margin="1" Padding="10,40">
        <!-- Segmento 1: lista de horários disponíveis -->
        <Grid x:Name="ScheduleListView" IsVisible="True" RowDefinitions="*, Auto" RowSpacing="10">
            <CollectionView x:Name="SchedulingList" Grid.Row="0" ItemsSource="{Binding Grades}" VerticalScrollBarVisibility="Always">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <ContentView>
                            <Border Margin="5" MaximumWidthRequest="500">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="10,10,10,10"></RoundRectangle>
                                </Border.StrokeShape>

                                <Grid RowDefinitions="Auto, *" RowSpacing="5">
                                    <BoxView Style="{StaticResource CardHeadingStyle}" Grid.Row="0"/>
                                    <HorizontalStackLayout Spacing="5" Grid.Row="0" Margin="5">
                                        <Label Text="{Binding Identification}" HorizontalTextAlignment="Center" FontAttributes="Bold" TextColor="White"/>
                                        <Label Text="{Binding GradeIdentification}" HorizontalTextAlignment="Center" FontAttributes="Bold" TextColor="White"/>
                                    </HorizontalStackLayout>

                                    <!-- Conteúdo -->
                                    <FlexLayout Wrap="Wrap" AlignItems="Center" JustifyContent="SpaceBetween" Margin="10" Grid.Row="1">
                                        <HorizontalStackLayout Spacing="4">
                                            <Label Text="Identificação: " HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                            <Label Text="{Binding Identification}" HorizontalTextAlignment="Center"/>
                                        </HorizontalStackLayout>

                                        <HorizontalStackLayout Spacing="4">
                                            <Label Text="Turma: " HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                            <Label Text="{Binding Classroom}" HorizontalTextAlignment="Center"/>
                                        </HorizontalStackLayout>

                                        <HorizontalStackLayout Spacing="4">
                                            <Label Text="Dia: " HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                            <Label Text="{Binding Day}" HorizontalTextAlignment="Center"/>
                                        </HorizontalStackLayout>

                                        <HorizontalStackLayout Spacing="4">
                                            <Label Text="Horário: " HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                            <Label Text="{Binding PeriodStart}" HorizontalTextAlignment="Center"/>
                                            <Label Text=" - " HorizontalTextAlignment="Center"/>
                                            <Label Text="{Binding PeriodEnd}" HorizontalTextAlignment="Center"/>
                                        </HorizontalStackLayout>

                                        <Button Text="Remover" Grid.Row="1"  Grid.Column="2" Style="{StaticResource ButtonStyle1}" Clicked="OnRemoveRequest"/>
                                    </FlexLayout>
                                </Grid>
                            </Border>
                        </ContentView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <HorizontalStackLayout Grid.Row="1" HorizontalOptions="Center">
                <Button Text="Adicionar" Clicked="OnScheduleClicked" Style="{StaticResource ButtonStyle1}"/>
                <Button Text="Sair" Clicked="OnExitClicked" Style="{StaticResource ButtonStyle1}"/>
            </HorizontalStackLayout>
        </Grid>

        <!-- Segmento 2: Edição de horário-->

        <FlexLayout x:Name="ScheduleEditView" IsVisible="False" Direction="Column" AlignItems="Center" JustifyContent="Center">
            <ScrollView Orientation="Both">
                <Grid ColumnDefinitions="*, Auto, Auto, Auto" RowDefinitions="*,*,*,*" RowSpacing="5" ColumnSpacing="10" Padding="5">
                    <!-- IDENTIFICAÇÃO -->
                    <Label Grid.Column="0" Grid.Row="0" Text="Cód. Identificação: " HorizontalTextAlignment="Start" FontAttributes="Bold"/>
                    <Entry Grid.Column="1" Grid.Row="0" Grid.ColumnSpan="3" Placeholder="000000" HorizontalTextAlignment="Center" TextChanged="OnTextChangeVerify" Completed="OnTextConfirm" Unfocused="OnTextConfirm"/>

                    <!-- TURMA -->
                    <Label Grid.Column="0" Grid.Row="1" Text="Turma: " HorizontalTextAlignment="Start" FontAttributes="Bold"/>
                    <Picker Grid.Column="1" Grid.Row="1" Grid.ColumnSpan="3" x:Name="ClassroomEntry" SelectedIndexChanged="OnClassConfirm"/>

                    <!-- DIA DA SEMANA-->
                    <Label Grid.Column="0" Grid.Row="2" Text="Dia: " HorizontalTextAlignment="Start" FontAttributes="Bold"/>
                    <Picker Grid.Column="1" Grid.Row="2" Grid.ColumnSpan="3" x:Name="WeekdayEntry" SelectedIndexChanged="OnWeekdayConfirm"/>

                    <!-- PERIODO -->
                    <Label Grid.Column="0" Grid.Row="3" Text="Período: " HorizontalTextAlignment="Start" FontAttributes="Bold"/>
                    <Picker Grid.Column="1" Grid.Row="3" x:Name="PeriodStartEntry" SelectedIndexChanged="OnPStartConfirm"/>
                    <Label Grid.Column="2" Grid.Row="3" Text=" – " HorizontalTextAlignment="Center" VerticalTextAlignment="Center" FontSize="Medium"/>
                    <Picker Grid.Column="3" Grid.Row="3" x:Name="PeriodEndEntry" SelectedIndexChanged="OnPEndConfirm"/>
                </Grid>
            </ScrollView>
            <HorizontalStackLayout>
                <Button Text="Confirmar" Clicked="OnConfirmClicked" Style="{StaticResource ButtonStyle1}"/>
                <Button Text="Cancelar" Clicked="OnCancelClicked" Style="{StaticResource ButtonStyle1}"/>
            </HorizontalStackLayout>
        </FlexLayout>
    </Grid>
</toolkit:Popup>